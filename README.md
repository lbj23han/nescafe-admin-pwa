# nescafe-ledger â˜•ï¸

**nescafe-ledger**ëŠ” ì‹¤ì œ ê°€ì¡± ìš´ì˜ ì¹´í˜ì—ì„œ ì‚¬ìš©í•˜ëŠ”  
**ì˜ˆì¹˜ê¸ˆ Â· ë¯¸ìˆ˜ê¸ˆ Â· ì£¼ë¬¸ Â· ì˜ˆì•½ ë‚´ì—­**ì„ ê´€ë¦¬í•˜ê¸° ìœ„í•œ  
**ë‚´ë¶€ ì „ìš© ì¥ë¶€ ê´€ë¦¬ PWA ì›¹ì•±**ì…ë‹ˆë‹¤.

ì‹¤ì‚¬ìš©ìì¸ ì–´ë¨¸ë‹ˆê°€ **ìŠ¤ë§ˆíŠ¸í°ì—ì„œ ì•±ì²˜ëŸ¼ ê°„í¸í•˜ê²Œ ê¸°ë¡Â·ì¡°íšŒ**í•  ìˆ˜ ìˆë„ë¡  
**ëª¨ë°”ì¼ ìš°ì„  UX + ë‹¨ìˆœí•œ ì…ë ¥ íë¦„**ì„ ìµœìš°ì„  ëª©í‘œë¡œ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤.

> ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: **2026-02-16 (KST)**

---

## ğŸ—‚ Version History

- **v1.x**: LocalStorage ê¸°ë°˜ ë‹¨ì¼ ê¸°ê¸° MVP
- **v2.0**: Supabase ë°±ì—”ë“œ ì—°ë™ + ê³„ì • ê¸°ë°˜ ë°ì´í„° ë¶„ë¦¬
- **v2.1**: ì§ì› ì´ˆëŒ€ & ê¶Œí•œ ê´€ë¦¬ í™•ì¥ (**ë°°í¬ ì™„ë£Œ**)
- **v2.2**: Day ì˜ˆì•½ ì…ë ¥ UX ê°œì„  (Quick Chips)
- **v3.0**: AI Helper ë„ì… (**ì§„í–‰ ì¤‘ / feat/floating-menu-ai-helper**)

---

## âœ¨ Features

## v2.1 â€” ì§ì› ì´ˆëŒ€ & ê¶Œí•œ ê´€ë¦¬

### ğŸ” ì¸ì¦ (Auth)

- Supabase Email Auth ê¸°ë°˜ ë¡œê·¸ì¸/íšŒì›ê°€ì…
- Next.js App Router + Server Components ì¸ì¦ íë¦„
- ì¿ í‚¤ ê¸°ë°˜ ì„¸ì…˜ ìœ ì§€ë¡œ SSR ì•ˆì •ì„± í™•ë³´
- `/auth/callback` ì´ë©”ì¼ ì¸ì¦ ì²˜ë¦¬

### ğŸ‘¤ ê³„ì • & ê¶Œí•œ ëª¨ë¸

- **Shop ë‹¨ìœ„ ë°ì´í„° ë¶„ë¦¬**
- `profiles` í…Œì´ë¸” ê¸°ë°˜ ê¶Œí•œ ê´€ë¦¬
- ê¶Œí•œ ë ˆë²¨
  - **Owner**: ì „ì²´ ê´€ë¦¬
  - **Admin**: ê´€ë¦¬
  - **Staff / Viewer**: ì¡°íšŒÂ·ì…ë ¥
- RLS(Row Level Security) ê¸°ë°˜ ì ‘ê·¼ ì œì–´

### ğŸ“¨ ì§ì› ì´ˆëŒ€ (Invite)

- ì´ë©”ì¼ ê¸°ë°˜ ì§ì› ì´ˆëŒ€
- ì´ˆëŒ€ ìƒíƒœ ê´€ë¦¬ (`pending / accepted / expired`)
- ì´ˆëŒ€ ìˆ˜ë½ ì‹œ ìë™ ì²˜ë¦¬
  - `profiles.shop_id` ì—°ê²°
  - `profiles.role` ë¶€ì—¬
- Owner/Adminë§Œ ì´ˆëŒ€ ê´€ë¦¬ ê°€ëŠ¥
- ë§ˆì´í˜ì´ì§€ ì´ˆëŒ€ ê´€ë¦¬ UI (ëª¨ë°”ì¼ ìµœì í™”)
- Viewer ê³„ì •ì€ ì´ˆëŒ€ UI ë¹„ë…¸ì¶œ

### ğŸ‘¤ ë§ˆì´í˜ì´ì§€ (`/mypage`)

- ë‚´ ê³„ì • ì •ë³´ ì¡°íšŒ
  - ê°€ê²Œëª…
  - ì§ì±… / ê¶Œí•œ ë ˆë²¨
- ë¡œê·¸ì•„ì›ƒ
- ì§ì› ì´ˆëŒ€ ê´€ë¦¬ (Owner/Admin ì „ìš©)

### ğŸ§­ Bottom Navigation

- ëª¨ë°”ì¼ PWA í™˜ê²½ ìµœì í™”
- í„°ì¹˜ ì˜ì—­ í™•ì¥
- ë°˜ì‘í˜• grid
- ëª…í™•í•œ active ìƒíƒœ í‘œì‹œ

---

## v2.2 â€” Day ì˜ˆì•½ ì…ë ¥ UX ê°œì„ 

### â° ì‹œê°„ ì…ë ¥ UX ê°œì„  (Quick Chips)

- ì˜ˆì•½ ì‹œê°„ ì…ë ¥ ì‹œ **í‚¤ë³´ë“œ ì…ë ¥ ë¶€ë‹´ì„ ì¤„ì´ê¸° ìœ„í•´** ë¹ ë¥¸ ì„ íƒ Chips UI ë„ì…
- TextInputì€ ê·¸ëŒ€ë¡œ ìœ ì§€í•˜ë©°, **ì‹œê°„ í•„ë“œ í´ë¦­/í¬ì»¤ìŠ¤ ì‹œì—ë§Œ** Chipsê°€ ì•„ë˜ì— í‘œì‹œë¨
- ê¸°ë³¸ í¬ë§·ì€ ê¸°ì¡´ê³¼ ë™ì¼í•˜ê²Œ **HH:mm** ìœ ì§€ (ì˜ˆ: `14:00`)
- Add / Edit í¼ ëª¨ë‘ ë™ì¼ UXë¡œ ì ìš©
- ì˜ˆì•½ UI í† í°(`reservation.ui.ts`)ì— ë ˆì´ì•„ì›ƒ/ì¹© ìŠ¤íƒ€ì¼ì„ ë¶„ë¦¬í•˜ì—¬ **View ì»´í¬ë„ŒíŠ¸ì˜ Tailwind ì§ì ‘ ì‚¬ìš© ìµœì†Œí™”**

---

## Department ì¥ë¶€ ê´€ë¦¬

- `departments`, `department_history` Supabase ì—°ë™
- Repository íŒ¨í„´ ê¸°ë°˜ ë°ì´í„° ì ‘ê·¼ (`lib/repositories/*`)
- ì˜ˆì¹˜ê¸ˆ / ë¯¸ìˆ˜ê¸ˆ / íˆìŠ¤í† ë¦¬ ê´€ë¦¬
- íˆìŠ¤í† ë¦¬ íƒ€ì…
  - `deposit` : ì˜ˆì¹˜ê¸ˆ ì…ê¸ˆ
  - `order` : ì£¼ë¬¸(ì˜ˆì¹˜ê¸ˆ ìš°ì„  ì°¨ê° + ë¶€ì¡±ë¶„ì€ ë¯¸ìˆ˜ê¸ˆ ì „í™˜)
  - `debtPayment` : ë¯¸ìˆ˜ê¸ˆ ìƒí™˜
  - `payment` : ì˜ˆì¹˜ê¸ˆ ì°¨ê°(ë¯¸ìˆ˜ê¸ˆ ì „í™˜ ì—†ìŒ)
- Shop ë‹¨ìœ„ RLS ë¶„ë¦¬

---

## ì˜ˆì•½ / ë§¤ì¶œ ê´€ë¦¬

- ì›”ê°„ ìº˜ë¦°ë” ê¸°ë°˜ ì˜ˆì•½ ì¡°íšŒ
- ë‚ ì§œ ë²”ìœ„ ì¿¼ë¦¬ ë¡œë”©
- ì¼ìë³„ ì˜ˆì•½/ë§¤ì¶œ ìš”ì•½
- Day ë„ë©”ì¸ ë‹¨ìœ„ ë¡œì§ ë¶„ë¦¬ (`hooks/reservation/*`)

### ì˜ˆì•½ ì™„ë£Œ ì‹œ ì¥ë¶€ ìë™ ë°˜ì˜

- **ë¶€ì„œ ì—°ë™ ì˜ˆì•½ë§Œ** ì™„ë£Œ ì‹œ ì¥ë¶€ ë°˜ì˜
- ì •ì‚° ë°©ì‹
  - ì£¼ë¬¸(debt) ê³ ì •
  - ì˜ˆì¹˜ê¸ˆ ìš°ì„  ì°¨ê° â†’ ë¶€ì¡±ë¶„ ë¯¸ìˆ˜ê¸ˆ ì „í™˜
- reservationë‹¹ history ìµœëŒ€ 1ê±´
  - `source_type = 'reservation'`
  - `source_id = reservation.id`
  - DB unique indexë¡œ ì¤‘ë³µ ë°©ì§€
- ì™„ë£Œ ì „ **ì •ì‚° ì•ˆë‚´ Sheet UX** ì œê³µ

---

## v3.0 â€” AI Helper (ì§„í–‰ ì¤‘)

Floating Menuì—ì„œ AI ë¹„ì„œë¥¼ í˜¸ì¶œí•´, ìì—°ì–´ ì…ë ¥ì„ **ë¯¸ë¦¬ë³´ê¸° â†’ í™•ì¸ â†’ í•´ë‹¹ í˜ì´ì§€ì— í”„ë¦¬í•„**í•˜ëŠ” íë¦„ì„ ì œê³µí•©ë‹ˆë‹¤.

### âœ… ì§€ì› ë²”ìœ„ (í˜„ì¬)

#### 1) ì˜ˆì•½ê´€ë¦¬ (ì™„ë£Œ/ìš´ì˜)

- ìì—°ì–´ ì…ë ¥ â†’ ì˜ˆì•½ ë“±ë¡ í˜ì´ì§€(`/day/[date]`)ë¡œ ì´ë™
- ì…ë ¥ê°’ì„ **í”„ë¦¬í•„(QueryString)**ë¡œ ì±„ì›Œ ì‚¬ìš©ìê°€ ë§ˆì§€ë§‰ í™•ì¸ í›„ ì €ì¥

ì˜ˆì‹œ:

- `ë‚´ì¼ 3ì‹œ Aë¶€ì„œ ì•„ë©”ë¦¬ì¹´ë…¸ 2ì” 8000ì›`
- `ë‹¤ìŒì£¼ ìˆ˜ìš”ì¼ Bë¶€ì„œ ë¼ë–¼ 2ì”`

#### 2) ì¥ë¶€ê´€ë¦¬ (í”„ë¦¬í•„ ê¸°ë°˜)

- ìì—°ì–´ ì…ë ¥ â†’ **ë¶€ì„œ ì¥ë¶€ í˜ì´ì§€(`/departments`)ì˜ í•´ë‹¹ ë¶€ì„œ ì¹´ë“œì— í”„ë¦¬í•„**
- **DB writeëŠ” AIê°€ ì§ì ‘ í•˜ì§€ ì•ŠìŒ**
- ì‚¬ìš©ìê°€ ê¸°ì¡´ UI(íˆìŠ¤í† ë¦¬ ì¶”ê°€/ë²„íŠ¼)ë¡œ ìµœì¢… ë°˜ì˜

ì˜ˆì‹œ:

- `ê³µì •ê²½ì œê³¼ 5ë§Œì› ì…ê¸ˆ`
- `Aë¶€ì„œ ì˜ˆì¹˜ê¸ˆ 1ë§Œì› ì°¨ê°`

> ì •ì±…: â€œAIê°€ ë°”ë¡œ ì €ì¥â€ì´ ì•„ë‹ˆë¼, **ê¸°ì¡´ í™”ë©´/ë²„íŠ¼ì„ í†µí•´ ìµœì¢… ë°˜ì˜**í•˜ëŠ” ì•ˆì „í•œ íë¦„ì„ ìœ ì§€í•©ë‹ˆë‹¤.

---

## ğŸ§± Tech Stack

- **Framework**: Next.js (App Router)
- **Language**: TypeScript
- **Styling**: Tailwind CSS
- **State**: React Hooks (Custom Hooks ì¤‘ì‹¬)
- **PWA**: next-pwa
- **Backend**: Supabase
- **Auth**: Supabase Auth
- **Database**: PostgreSQL (Supabase)
- **AI**: OpenAI API (v3)

---

## ğŸ“‚ Project Structure

```bash
src/
â”œâ”€ app/
â”‚  â”œâ”€ page.tsx
â”‚  â”œâ”€ auth/callback/
â”‚  â”œâ”€ invite/[token]/
â”‚  â””â”€ (authed)/
â”‚     â”œâ”€ layout.tsx
â”‚     â”œâ”€ main/
â”‚     â”œâ”€ day/
â”‚     â”œâ”€ departments/
â”‚     â””â”€ mypage/
â”œâ”€ components/
â”‚  â”œâ”€ pages/
â”‚  â”œâ”€ ui/
â”‚  â””â”€ navigation/
â”œâ”€ hooks/
â”‚  â”œâ”€ ai/
â”‚  â””â”€ reservation/
â”œâ”€ lib/
â”‚  â”œâ”€ repositories/
â”‚  â”œâ”€ storage/
â”‚  â””â”€ domain/
â”œâ”€ constants/
â””â”€ scripts/
```

---

## ğŸš§ Roadmap

### ë‹¤ìŒ ë‹¨ê³„ (v3 polish)

- ì¥ë¶€ í”„ë¦¬í•„ ì‹œ :
  - í•´ë‹¹ ë¶€ì„œ ì¹´ë“œ ìë™ expand + ìŠ¤í¬ë¡¤ í¬ì»¤ìŠ¤
  - "AIë¡œ ì±„ì›Œì§" í‘œì‹œ ë° 1íšŒ ì ìš© í›„ querystring ì •ë¦¬
- AI í•´ì„ í’ˆì§ˆ ê°œì„ :
  - ë¶€ì„œ ë§¤ì¹­ ê°•í™”(ìœ ì‚¬ì–´/ì•½ì¹­)
  - warnings/assumptions ë…¸ì´ì¦ˆ ìµœì†Œí™”
- (ì˜µì…˜)"ì‚¬ì†Œí•œ ì§ˆë¬¸" ìœ í‹¸ íƒ­/ ë²„íŠ¼:
  - ë‚ ì”¨, ê°„ë‹¨ ê³„ì‚°, ë©”ëª¨ ë“±
  - ì—…ë¬´í˜• AI(route)ì™€ ë¶„ë¦¬í•œ ë³„ë„ ìœ í‹¸ routeë¡œ í™•ì¥

---
